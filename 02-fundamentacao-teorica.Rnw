\chapter{Fundamentação Teórica}\label{cap:fundamentacao}

\section{Ciência de Dados}

Segundo \citeonline{Stanton2012}, o termo Ciência de Dados (do inglês
\emph{Data Science}) é usado para definir uma área emergente que se ocupa da
coleta, preparo, análise, visualização, gestão e preservação de conjuntos de
dados com o objetivo de extrair conhecimento. Ela usa a ciência da computação
como ferramenta para extrair modelos estatísticos a partir de dados relativos a
uma área fim, como a ciência política.

Por ser uma área interdisciplinar e relativamente recente (especialmente no
Brasil) a distinção do que é ciência de dados e não estatística, matemática ou
computação pode ainda não ser muito clara \cite{Porto2014}. Para facilitar essa
diferenciação, \citeonline{Conway2013} criou o diagrama de Venn da figura
\ref{fig:ciencia-de-dados-venn} que mostra onde está a ciência de dados em
relação as outras áreas.

\begin{figure}[h]
\includegraphics{ciencia-de-dados-diagrama-venn}
\caption{Diagrama de Venn mostrando as habilidades necessárias para um
cientista de dados}
\label{fig:ciencia-de-dados-venn}
\end{figure}

Com as técnicas da ciência de dados, podemos responder perguntas como ``Qual a
melhor rota para chegar até meu trabalho?'', ``Vai chover hoje?'', ``Quais são
minhas chances de desenvolver câncer nos próximos 10 anos?''. Neste trabalho,
estamos interessados nas técnicas de desenvolvimento de modelos preditivos que,
baseados nos dados e conhecimento que temos do assunto, determinam a
probabilidade de acontecimentos futuros.

\subsection{Modelos preditivos}

\citeonline{Geisser1993} define modelagem preditiva como sendo ``o processo
pelo qual um modelo é criado ou escolhido para tentar melhor prever a
probabilidade de um resultado''. Já \citeonline{Kuhn2013} definem como ``o
processo de desenvolvimento de uma ferramenta ou modelo matemático que gere uma
previsão precisa''.

Independente da definição usada, modelos preditivos fazem parte do dia-a-dia da
sociedade atual. O Google os utiliza para interpretar o que seus usuários estão
buscando; o Netflix usa para recomendar filmes; corretoras de valores usam para
definir que ações comprar ou vender; seguradoras usam para definir qual o risco
e, consequentemente, o preço do seguro de um carro, entre outros
\cite{Levy2010}.

Existem duas principais categorias de problemas que podem ser resolvidos por
modelos preditivos: regressão e classificação. A diferença entre eles está no
tipo de resposta que queremos prever, se é contínua ou categórica, que
influencia nos tipos de modelos que podem ser usados e na forma de avaliá-los.
Por exemplo, ao analisarmos modelos que preveem o preço de um imóvel a partir
da sua área, buscamos o que chegue mais próximo do valor real\footnote{Esta é
uma simplificação. Existem diversas outras características a serem analisados
ao escolher um modelo, como facilidade de interpretação, velocidade de
execução, entre outras. Aqui consideramos que a única diferença entre eles seja
o resultado previsto.}. Já ao avaliar modelos que classifiquem imagens dos
dígitos 0 a 9, só nos interessamos na classificação correta; dois modelos que
identifiquem a imagem do número 1 como sendo do número 3 e 8 estão igualmente
errados. O que classificou como 3 não está ``menos errado'' do que o que
classificou como 8 \cite{Kuhn2013,Zumel2014}. Neste trabalho, nosso foco é em
classificação.

\subsection{Avaliando performance em modelos de classificação}

O primeiro passo para melhorar algo é conseguir mensurá-lo, ao contrário não
saberemos se nossas modificações estão melhorando ou piorando a situação. Com
relação a modelos preditivos, o ideal é ter uma métrica única que defina sua
performance de acordo com nossos critérios. Dessa forma, a comparação e
otimização dos modelos é simplificada \cite{Ng2012}.

Uma das formas mais comuns de descrever a perfomance de um modelo de
classificação é através de uma ``matriz de confusão''. A tabela
\ref{table:exemplo-matriz-de-confusao} mostra um exemplo de matriz de confusão
com duas categorias: ``positivo'' e ``negativo''. Na diagonal principal estão
os valores classificados corretamente, e fora dela estão os erros. Dessa matriz
podemos extrair diversas métricas, como:

\begin{table}
\centering
\begin{tabular}{c c c}
  Previsto & \multicolumn{2}{c}{Observado} \\  \cline{2-3}
  & \multicolumn{1}{|c}{Positivo} & \multicolumn{1}{c|}{Negativo} \\
  \hline
  \multicolumn{1}{|c|}{Positivo} & Verdadeiro positivo (VP) & \multicolumn{1}{c|}{Falso positivo (FP)} \\
  \multicolumn{1}{|c|}{Negativo} & Falso negativo (FN) & \multicolumn{1}{c|}{Verdadeiro negativo (VN)} \\
  \hline
\end{tabular}
\caption{Matriz de confusão para um problema com duas classes: ``positivo'' e
``negativo''.}
\label{table:exemplo-matriz-de-confusao}
\end{table}

\begin{description}
\item[Número de amostras positivas]
\begin{equation}
\label{eq:positive-rate}
P = VP + FN
\end{equation}
\item[Número de amostras negativas]
\begin{equation}
\label{eq:negative-rate}
N = VN + FP
\end{equation}
\item[Acurácia] Proporção de predições corretas
\begin{equation}
\label{eq:accuracy}
ACC = \frac{VP + VN}{P + N}
\end{equation}
\item[Sensibilidade] Proporção de elementos da classe positiva classificados
corretamente com relação ao total de elementos positivos
\begin{equation}
\label{eq:sensitivity}
SENS = \frac{VP}{VP + FN}
\end{equation}
\item[Especificidade] Proporção de elementos da classe negativa classificados
corretamente com relação ao total de elementos negativos
\begin{equation}
\label{eq:specificity}
ESPEC = \frac{VN}{FP + VN}
\end{equation}
\end{description}

Dessas métricas, a com interpretação mais simples é a acurácia (equação
\ref{eq:accuracy}), que mede o percentual de predições corretas. Entretanto,
ela tem algumas limitações. Primeiramente, ela não leva em consideração o tipo
do erro. Em diversos problemas, o custo de um falso positivo é diferente do de
um falso negativo. Por exemplo, num sistema de classificação de spam, é
preferível que o usuário veja uma propaganda (falso negativo) do que deixe de
receber um e-mail importante (falso positivo). Além disso, ela também não
considera a frequência natural de cada classe. Se, por exemplo, 90\% dos
e-mails que eu receba não sejam spam, um modelo que simplesmente classifique
todo e-mail como não sendo spam terá 90\% de acurácia \cite{Kuhn2013}.

O \emph{Kappa} é uma métrica que leva em consideração as proporções das
classes. Ela pode assumir valores entre -1 e 1, sendo que 1 indica que todas as
predições foram corretas, -1 indica que todas foram erradas, e 0 que o modelo
tem uma performance igual a um modelo aleatório. A equação \ref{eq:kappa}
mostra como calculá-la, onde $ACC$ é a acurácia observada e $ACC_{esperada}$ é
a acurácia esperada \cite{Cohen1960}.

\begin{equation}
\label{eq:kappa}
Kappa = \frac{ACC - ACC_{esperada}}{1 - ACC_{esperada}}
\end{equation}

Em geral, o resultado do uso de modelos de classificação é a probabilidade de
pertencimento a cada categoria. Por exemplo, um modelo pode, ao analisar um
e-mail, determinar que ele tem 75\% de chances de ser spam e, consequentemente,
25\% de chances de não ser. Para transformar essa probabilidade em uma
categoria, define-se um ponto de corte. Por padrão, ele é definido em grande
parte das ferramentas como 50\%. Usando esse valor, o exemplo anterior seria
classificado como spam \cite{Kuhn2013}.

Esse padrão é uma escolha interessante caso o custo de um falso positivo ou
falso negativo seja o mesmo e as categorias sejam balanceadas. Caso contrário,
é recomendável testar outros valores. Uma ferramenta para analisar a
sensibilidade e especificidade de um modelo usando diferentes pontos de corte é
a curva ROC (\emph{Receiver Operator Characteristic}). Essa visualização mostra
os valores de sensibilidade e especificidade em diferentes pontos de corte
\cite{Altman1994,Brown2006,Fawcett2006}.

A figura \ref{fig:exemplo-roc} mostra um exemplo de uma curva ROC com os
valores discriminados em dois pontos. A partir desse gráfico, percebemos a
troca entre sensibilidade e especificidade (quanto maior um, menor o outro), e
podemos escolher o melhor ponto de corte para o modelo em questão levando em
consideração nossos objetivos.

<<exemplo-roc, fig.cap="Curva ROC de um modelo mostrando a área sob a curva (AUC) e dois pontos de corte: 0,5, o mais comum, e 0,614, o mais próximo do canto superior esquerdo.">>=
set.seed(1)
training = twoClassSim()
testing = twoClassSim()

fit = train(Class ~ TwoFactor1 + TwoFactor2 + Linear03,
            data = training,
            method = "glm")

roc0 = roc(testing$Class,
           predict(fit, newdata = testing, type = "prob")[,1],
           levels = levels(testing$Class),
           plot = TRUE,
           print.thres = c(0.5, 0.614),
           print.auc = TRUE,
           print.thres.pattern = "%.3f (Espec = %.3f, Sens = %.3f)",
           xlab = "Especificidade",
           ylab = "Sensibilidade")
@

Além de auxiliar na escolha do ponto de corte, a curva ROC também pode ser
usada para avaliar e comparar modelos desenhando-os num mesmo gráfico ou
comparando a área sob suas curvas (AUC). O modelo na figura
\ref{fig:exemplo-roc} possui AUC 0,787. Quanto mais próximo a curva está do
canto superior esquerdo, maior é seu AUC e, consequentemente, maior é sua
performance. O modelo perfeito tem AUC 1, já um modelo aleatório tem AUC
próximo de 0,5 e segue na diagonal do gráfico. O que caracteriza é um AUC bom
ou ruim varia de caso a caso, mas \citeonline{HosmerJr2013} definiram uma regra
geral para avaliação descrita na tabela \ref{table:valores-auc}.

\begin{table}
\centering
\begin{tabular}{c l}
  AUC & \multicolumn{1}{c}{Valor} \\
  \hline
  0,5 & Não há discriminação \\
  Entre 0,7 e 0,8 & Discriminação aceitável \\
  Entre 0,8 e 0,9 & Discriminação excelente \\
  Acima de 0,9 & Discriminação excepcional \\
\end{tabular}
\caption{Regra geral para avaliação da área sob a curva ROC de \citeonline{HosmerJr2013}.}
\label{table:valores-auc}
\end{table}

% TODO: Concluir

% % Treinamento de algoritmos
% % Regressão VS Classificação

% Random Forest
% % Árvores de decisão

% Validação cruzada

\section{Modelos espaciais de votação}

<<>>=
parlamentares = data.frame(maioridade_penal = c(16, 17, 15, 18, 20),
                           salario_minimo = c(1000, 900, 1200, 1100, 1500))
maioridade_penal = c(16, 18)
salario_minimo = c(1200, 1000)
cutlines = data.frame(maioridade_penal = mean(maioridade_penal),
                      salario_minimo = mean(salario_minimo))
@

A ideia básica de modelos espaciais de votação é que o conjunto de alternativas
políticas de uma votação pode ser tratado como uma dimensão em um espaço
euclidiano, e cada parlamentar tem preferências de valores nessa dimensão. O
voto seria então definido pela escolha da alternativa mais próxima da sua
preferência.

Há diversos modelos para estimar esses valores, como o NOMINATE, W-NOMINATE,
DW-NOMINATE, que são paramétricos; o Optimal Classification, que é
não-paramétrico, e; modelos baseados em estatística Bayesiana, como o IDEAL.
Nosso foco neste trabalho é no W-NOMINATE.
\cite{Poole2000,Poole2005,Poole2014,Jackman2000,Clinton2004}

Considere um exemplo onde \Sexpr{nrow(parlamentares)} parlamentares votam em
dois projetos de Lei: um propondo a redução da maioridade penal de
\Sexpr{max(maioridade_penal)} para \Sexpr{min(maioridade_penal)} anos e outra
propondo o aumento do salário-mínimo de R\$ \Sexpr{min(salario_minimo)} para
R\$ \Sexpr{max(salario_minimo)}. Suponha que cada um tem uma única preferência
(\emph{single-peakedness}), conhecido como seu ponto ideal, e vota sinceramente
de acordo com ela. Considere também que as preferências são simétricas. Isto é,
dado duas escolhas a uma mesma distância do ponto ideal de um parlamentar, ele
será indiferente a qualquer uma delas.

Graficamente, temos a figura \ref{fig:modelo-espacial-votacao}, onde os pontos
representam as preferências dos legisladores sobre cada votação, representados
como as dimensões nesse espaço euclidiano. As linhas são chamadas linhas de
corte. Elas passam pelo ponto médio entre as duas alternativas em votação: a de
votar sim e a de votar não. Em outras palavras, se as escolhas são entre uma
maioridade penal de \Sexpr{min(maioridade_penal)} ou
\Sexpr{max(maioridade_penal)}, a linha de corte passa em $\frac{16 + 18}{2}$,
ou seja, $17$. Ela divide os legisladores que irão votar não, que estão a
esquerda da linha, dos que irão votar sim, que estão a direita da mesma. Caso
esteja sobre a linha de corte, ele é indiferente as alternativas.

<<modelo-espacial-votacao, fig.cap="Preferências de 5 deputados em 2 votações com suas respectivas linhas de corte">>=
ggplot(parlamentares, aes(x = maioridade_penal, y = salario_minimo)) +
  geom_vline(aes(xintercept = cutlines$maioridade_penal)) +
  geom_hline(aes(yintercept = cutlines$salario_minimo)) +
  geom_point(size = 3) +
  labs(x = "Maioridade penal", y = "Salário mínimo")
@

Nesse exemplo estamos mostrando duas dimensões, mas o algoritmo é capaz de
estimar os pontos ideais em até dez dimensões.

% FIXME: Descrever as características do W-NOMINATE e (talvez) como ele se
% diferencia dos outros.

O comportamento dos parlamentares é assumido como sendo formado por dois
componentes: um determinístico e outro estocástico. Formalmente, definimos a
utilidade do legislador $i$ na consequência política do resultado ``sim'' da
votação $j$ como sendo:

\begin{equation}
  U_{ijy} = u_{ijy} + \epsilon_{ijy}
\end{equation}

onde $u_{ijy}$ é a parte determinística e $\epsilon_{ijy}$ é a parte
estocástica da função utilidade. Se não houver erro, o legislador vota sim se
$U_{ijy} > U_{ijn}$ e não se $U_{ijy} < U_{ijn}$. Caso $U_{ijy} = U_{ijn}$, ele
é indiferente para qualquer resultado.

\begin{description}
\item[$s$] o número de dimensões indexado por $k = 1, ..., s$;
\item[$p$] o número de parlamentares indexado por $i = 1, ..., p$;
\item[$q$] o número de votações indexado por $j = 1, ..., q$;
\item[$X_i$] o ponto ideal do parlamentar $i$ em um vetor de comprimento $s$;
\item[$Z_{jy}$ e $Z_{jn}$] a representação de cada votação em um vetor de comprimento
$s$, onde $y$ e $n$ são as consequências políticas dos resultados ``Sim'' e
``Não'', respectivamente.
\end{description}

A utilidade do parlamentar $i$ para a consequência $y$ em uma votação $j$ é:

\begin{equation}
  U_{ijy} = \beta \exp^{\left( - \frac{1}{2} \sum\limits_{k=1}^s w_k^2 d_{ijky}^2 \right)}
\end{equation}

Formalmente, sendo $O_{jy}$ e $O_{jn}$ os resultados correspondendo
respectivamente a um voto ``sim'' e um voto ``não'' na votação $j$ ($j = 1,
..., q$), definimos $Z_j$ como: 

\begin{equation}\label{eq:cutpoint}
  Z_j = \frac{O_{jy} + O_{jn}}{2}
\end{equation}

O $Z_j$ pode definir um ponto, linha, plano ou hiperplano, dependendo do número
de dimensões que estamos tratando. Ele é conhecido como ponto (ou linha, etc.)
de corte.

% Introdução

%% O que são de modelos de votação?

%% Por que os modelos espaciais de votação foram criados?

%% Por que não usar os votos diretamente?

% Desenvolvimento

% Conclusão

\subsection{Comparando pontos ideais ao longo do tempo}
\label{cap:fundamentacao:comparando-pontos-ideais-no-tempo}

O principal problema em comparar mudanças nos pontos ideais ao longo do tempo é
distinguir alterações causadas por mudanças na agenda legislativa das causadas
por mudanças no posicionamento dos parlamentares \cite{Bailey2007}. Em outras
palavras, se o ponto ideal de um deputado federal passa de 0.3 para -0.2 de um ano
para o outro, como descobrir se isso representa uma mudança real de ideologia ou
é somente reflexo da diferença na agenda legislativa dos dois períodos?

Segundo \citeonline{Shor2010}, todos os esforços para resolver esse problema
usam ``pontes'', que podem ser parlamentares cujo posicionamento assume-se ter
se mantido estável durante o período de interesse, ou; projetos de Lei que
foram votados em mais de um momento (nas duas casas legislativas em um sistema
bicameral, por exemplo). O primeiro é mais usado para comparar as mudanças nos
posicionamentos dos parlamentares, enquanto o segundo permite unir pessoas que
não votaram juntas em um mesmo mapa espacial\footnote{Por exemplo,
\citeonline{Shor2010} colocam todos os legisladores de 11 estados americanos e
do congresso federal em um período que varia entre 7 e 15 anos, dependendo do
estado, em um mesmo mapa espacial}. \citeonline{Poole2005} propõe duas formas
para estimar pontos ideais usando pontes.

Na primeira, batizada de \emph{pooled scaling} por \citeonline{Shor2010},
dividimos os votos dos parlamentares que queremos mensurar em dois
parlamentares ``virtuais'', um com os votos antes e outro com os votos depois
da data de interesse. Unimos esses parlamentares virtuais com os
parlamentares-ponte, que possuem um registro único, em uma tabela individual e
executamos o algoritmo de estimação dos pontos ideais. Ao final, teremos dois
pontos para cada parlamentar de interesse e um ponto para os pontes. Na
segunda, que \citeonline{Shor2010} chamam de \emph{linear mapping}, estimamos
os pontos ideias separadamente em cada período e os conectamos usando regressão
entre os conjuntos de pontos dos parlamentares-ponte. Ambas formas devem gerar
resultados similares, mas a segunda é computacionalmente mais simples, o que
pode ser essencial, dependendo da quantidade de parlamentares e votações votos
em estudo.

\citeonline{Poole2005} ainda descreve uma terceira forma, similar a
\emph{pooled scaling} descrita acima, que usa para testar se os senadores
norte-americanos mudam de comportamento nos últimos dois anos de seus mandatos,
antes de concorrer à reeleição. Neste caso, ele quer calcular a mudança de
comportamento de todos os legisladores em dois momentos numa mesma legislatura.
Se usássemos o \emph{pooled scaling} diretamente, precisaríamos escolher alguns
parlamentares como pontes que, por definição, não teriam mudado de
comportamento. Ao invés disso, ele segue o seguinte processo:

\begin{enumerate}
  \item Para cada parlamentar, faça:
    \begin{enumerate}
      \item Transforme-o em dois parlamentares ``virtuais'', um com o conjunto
de votos antes, e outro com os depois da data de interesse. Os outros
parlamentares não são modificados;
      \item Calcule os pontos ideias;
      \item Guarde os resultados dos dois parlamentares ``virtuais''. A
diferença entre suas posições representa a mudança de comportamento do
parlamentar.
    \end{enumerate}
  \item Calcule medidas de incerteza para as estimativas.
\end{enumerate}

Ao final, ele tem dois pontos para cada senador: um representando sua posição
nos primeiros 4, e o outro nos últimos 2 anos da legislatura. Note que, como as
matrizes de votações usadas para gerar os mapas espaciais são diferentes, eles
não são estritamente comparáveis. Apesar disso, \citeonline{Poole2005}
argumenta que como elas possuem o mesmo conjunto de votos, com a única
diferença de que um dos parlamentares foi dividido em dois, ele considera ser
seguro compará-las.

\section{Processo legislativo}

Como são criadas as Leis no Brasil? Essa seção pode ser gigantesca, então acho melhor focar no essencial e pontuar as características mais importantes para este trabalho, por exemplo o que são destaques, tipos de votação, tipos de votos, etc.

% ALEXANDRE: Acho que senado e câmara podem ser subseções desta seção.
% Essas subseções não precisam ser muito longas. Devem descrevas basicamente as competências e atribuições de cada casa.
%
% Acho que a justificativa da escolha da Câmara pode aparecer mais tarde, na seção do estudo de caso.  
% Assim a seção de fundamentação teórica fica sendo realmente apenas de fundamentação teórica, sem efeitos colaterais.

\subsection{Senado Federal}

Também chamada de Casa Alta, ela é composta por 81 senadores, 3 por cada Estado e Distrito Federal. Os senadores têm mandato de 8 anos e são eleitos pelo sistema majoritário\footnote{No sistema majoritário, o candidato mais votado é eleito. Nos anos em que são eleitos 2 senadores, os dois candidatos mais votados serão eleitos. Ele pressupõe um (ou dois) único candidatos por partido. É o mesmo sistema usado nas eleições para os chefes do Poder Executivo (presidente da República, governadores e prefeitos). Com exceção da eleição de senadores e prefeitos em cidades com menos de 200 mil habitantes, onde há um único turno, as eleições ocorrem em dois turnos. \cite{Carneiro2013}}. A renovação da casa é parcial, modificando $\frac{1}{3}$ e $\frac{2}{3}$ dos senadores alternadamente de 4 em 4 anos.

\subsection{Câmara dos Deputados}

Também chamada de Casa Baixa ou Casa do Povo, ela é composta por 513 deputados federais, cujo papel é representar o povo. Cada Estado ou Distrito Federal elege entre 8 e 70 deputados, proporcionalmente a sua população. Os deputados têm mandato de 4 anos, eleitos pelo sistema proporcional\footnote{No sistema proporcional os partidos registram vários candidatos para o mesmo cargo. Os votos recebidos por cada candidato são direcionados ao partido, que precisa atingir uma quantidade mínima de votos (chamado quociente eleitoral) para eleger ao menos um de seus candidatos. Nesse sistema, um candidato com menos votos pode se eleger, enquanto outro com mais votos não se elegeu, dependendo do partido de cada um deles. \cite{Carneiro2013,Bramatti2014}}. Diferente do Senado Federal, a renovação é total de 4 em 4 anos.

\section{Considerações Finais}
