

\chapter{Miolo da sua dissertação}\label{cap:miolo}

Nessa parte pretendo falar sobre a ferramenta desenvolvida, mostrar sua arquitetura e como cada parte funciona e pode ser modificada.

\section{Coleta dos dados}

A Câmara dos Deputados disponibiliza em seu site na
web\footnote{\url{http://www2.camara.leg.br/transparencia/dados-abertos}} uma
\gls{API} para acesso a diversos dados. Para extrair os resultados das
votações, usamos os métodos
\emph{ListarProposicoesVotadasEmPlenario}\footnote{\url{http://www2.camara.leg.br/transparencia/dados-abertos/dados-abertos-legislativo/webservices/proposicoes-1/ProposicoesVotadasEmPlenario}}
que a partir de um ano nos retorna a lista de proposições votadas; e o
\emph{ObterVotacaoProposicao}\footnote{\url{http://www2.camara.leg.br/transparencia/dados-abertos/dados-abertos-legislativo/webservices/proposicoes-1/obtervotacaoproposicao}}
que a partir do tipo, número e ano de uma proposição retorna os resultados das
votações ocorridas.  

Os dados são retornados no formato \gls{XML}. De posse deles, desenvolvemos um
programa em
Python\footnote{\url{https://github.com/vitorbaptista/codigo-mestrado}} para
transformá-los e importá-los em um banco de dados
SQLite\footnote{\url{https://www.sqlite.org/}}. A partir desse banco, geramos
dois arquivos por legislatura: um com os dados dos parlamentares e seus votos
(tabela \ref{table:votes}) e outro com os detalhes das votações (tabela
\ref{table:votes-metadata}).

Os nomes dos partidos foram normalizados para evitar que consideremos fusões ou
mudanças de nomes de partidos como um novo partido. Seguimos o padrão adotado
pelo \gls{CEBRAP}, onde mudanças de nome são identificados pela primeira e
última sigla (ex.: PJ se torna PRN que se torna PJC, então temos PJ>PTC) e
fusões são identificados pelo maior partido na data da fusão e o novo nome
(ex.: PL e PRONA se tornam PL>PR) \cite{Freitas2008}. A lista completa está no
apêndice \ref{apendice:lista-partidos}.

\begin{table}
\centering
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}
\begin{tabular}{r|l|l|l|r|r|r|r|r}
\hline
id & name & party & state & 76 & 273 & 271 & 272 & 485\\
\hline
3151 & Jairo Ataíde & PFL>DEM & MG & NA & 0 & NA & 0 & NA\\
\hline
4929 & Joseph Bandeira & PT & BA & NA & NA & NA & NA & NA\\
\hline
4930 & Silvio Costa & PSC & PE & 1 & 0 & 0 & 0 & 0\\
\hline
4931 & Izalci & PL+PRONA>PR & DF & 1 & 1 & 0 & 0 & 0\\
\hline
62881 & Danilo Forte & PMDB & CE & 1 & 1 & 0 & 0 & NA\\
\hline
67138 & Iracema Portella & PDS>PP & PI & 1 & 1 & 0 & 0 & 0\\
\hline
\end{tabular}


\end{knitrout}
\caption{Dados com detalhes dos parlamentares e seus respectivos votos. Não
mostramos todos os votos por limitações de espaço.}
\label{table:votes}
\end{table}

\begin{landscape}
\begin{table}
\centering
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}
\begin{tabular}{r|r|r|l|l|l}
\hline
id & id\_sessao & proposicao\_id & data & resumo & obj\_votacao\\
\hline
76 & 4212 & 491974 & 2011-02-15 21:09:00 & Aprovado o Requerime... & URGÊNCIA PARA O PL 3...\\
\hline
273 & 4215 & 491872 & 2011-02-16 00:17:00 & Mantida a expressão.... & DVS - Bloco PvPps - ...\\
\hline
271 & 4214 & 491872 & 2011-02-16 22:38:00 & Rejeitada a Emenda d... & DVS - PSDB - EMENDA ...\\
\hline
272 & 4214 & 491872 & 2011-02-16 23:27:00 & Rejeitada a Emenda d... & DVS - DEM - EMENDA N...\\
\hline
485 & 4219 & 485274 & 2011-02-22 17:36:00 & Rejeitado o Requerim... & REQUERIMENTO DE RETI...\\
\hline
486 & 4219 & 485274 & 2011-02-22 19:20:00 & Rejeitado o Requerim... & REQUERIMENTO DE ADIA...\\
\hline
487 & 4220 & 485274 & 2011-02-22 20:45:00 & Rejeitado o Requerim... & REQUERIMENTO DE RETI...\\
\hline
955 & 4221 & 485275 & 2011-02-23 17:01:00 & Rejeitado o Requerim... & REQUERIMENTO DE RETI...\\
\hline
1042 & 4251 & 485758 & 2011-04-05 17:02:00 & Rejeitado o Requerim... & REQUERIMENTO DE RETI...\\
\hline
1043 & 4251 & 485758 & 2011-04-05 19:11:00 & Rejeitado o Requerim... & REQUERIMENTO DE CONC...\\
\hline
\end{tabular}


\end{knitrout}
\caption{Dados com detalhes sobre cada votação. Os campos ``resumo'' e
``obj\_votacao'' foram limitados a 20 caracteres por
questões de formatação da página.}
\label{table:votes-metadata}
\end{table}
\end{landscape}

% \begin{listing}[ht]
% \begin{minted}{xml}
% <proposicoes>
%   <proposicao>
%     <codProposicao>19319</codProposicao>
%     <nomeProposicao>PL 3232/1992</nomeProposicao>
%     <dataVotacao>10/06/2014</dataVotacao>
%   </proposicao>
%   <proposicao>
%     <codProposicao>43617</codProposicao>
%     <nomeProposicao>PLP 275/2001</nomeProposicao>
%     <dataVotacao>22/04/2014</dataVotacao>
%   </proposicao>
%   <!-- Continua... -->
% </proposicoes>
% \end{minted}
% \caption{Resultado da API \emph{ListarProposicoesVotadasEmPlenario} usando o ano 2014 como parâmetro}
% \end{listing}

Restringimos a analisar da 50\textordfeminine{} até a 54\textordfeminine{}
legislatura, que compreende um período de 20 anos, entre o início do primeiro
governo de Fernando Henrique Cardoso em 1995 até o final do primeiro governo de
Dilma Rousseff em 2015. Esse recorte foi feito pois é quando, de acordo com
\cite{Freitas2008}, termina a fase de acomodação dos parlamentares as regras
definidas pela Constituição de 1988.

\begin{table}
\centering
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}
\begin{tabular}{r|r|r|r}
\hline
Legislatura & Deputados Federais & Votações & Votos\\
\hline
50 & 631 & 468 & 178603\\
\hline
51 & 624 & 419 & 155737\\
\hline
52 & 614 & 451 & 134461\\
\hline
53 & 606 & 619 & 192879\\
\hline
54 & 644 & 432 & 131552\\
\hline
\end{tabular}


\end{knitrout}
\caption{Número de deputados federais e votações por legislatura}
\label{table:estatisticas-legislaturas}
\end{table}

Na tabela \ref{table:estatisticas-legislaturas}, mostramos o número de
deputados federais e votações por legislatura. Consideramos deputados federais
todos parlamentares que participaram de alguma votação na Câmara dos Deputados
no período, por isso o número é maior do que o número de cadeiras. Por
legislatura, temos em média 623,80 deputados e 477,80
votações com 332,04 votos cada.

\section{Componentes}

Mostrar em linhas gerais como é organizada a ferramenta, indo de um nível de abstração mais alto (como o usuário vê a ferramenta) até uma arquitetura técnica.


% ALEXANDRE: Apesar de eu não ser muito fã acho importante apresentar algum tipo de diagrama de componentes nesta seção, para permitir uma visualização da arquitetura da solução.


\subsection{Extração dos dados}

Falar sobre as fontes de dados (câmara dos deputados, banco de dados legislativos do Cebrap, etc.), a forma de extração, passos de limpeza, banco de dados, frequência de atualização, se é pull ou push, e como disponibilizamos esses dados para as outras etapas. Ao término dessa seção, o leitor deverá entender nosso processo de data wrangling e saber como ele próprio pode, se quiser, baixar os dados ao final dessa etapa e fazer suas próprias análises. Talvez tenha problema com isso, pois o pessoal da CEBRAP pode não permitir a redistribuição de seus dados.


% ALEXANDRE: É interessante destacar que disponibilizar estes dados em um formato mais "amigável" também é uma contribuição do seu trabalho.

\subsection{Análise}

Aqui falarei sobre os algoritmos usados e as métricas escolhidas (coesão parlamentar, número de destaques, etc.). Também é bom frisar que a arquitetura permite adicionar novos algoritmos, talvez até de uma forma reativa. Por exemplo, considerando que a acusação que o PP trancou a pauta para pressionar o Lula a nomear uma pessoa na Petrobrás, poderíamos criar um algoritmo que detectasse trancamentos de pauta por um partido qualquer, para no futuro descobrirmos movimentações parecidas.

\subsection{Notificações/Relatórios}

Falar sobre como os usuários consomem esses dados. Minha ideia atual é gerar um relatório semanal/mensal/quando-aparecer-algo-interessante e enviá-lo por email pra quem se cadastrar. Nesse caso, devo mostrar exemplos desse relatório.


(Alexandre) Seria legal considerar também a criação de uma conta que twitaria periódicamente os relatórios.


\section{Considerações Finais}

Desenvolvi uma ferramenta que extrai dados de diversas fontes, os consolida, analisa e gera relatórios para os usuários. Cada parte pode ser modificada e expandida, e os dados (e algoritmos) podem ser usados por outras pessoas. Daqui falta validar que os algoritmos na parte de análise geram algo interessante.
